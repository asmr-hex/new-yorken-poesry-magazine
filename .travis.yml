sudo: required
language: node_js  # since we are building the prod bundle in travis
node_js:
  - "9.4.0"
services:
  # we need docker to run the tests; NOTE: tests are run against dev env
  - docker
env:
  # add secure environment variables
  global:
  - secure: anKSkkpOGUT4q0PQgJcwVfX1DT37lfXrGA1XNCFBSqTjdlICIwedYIeU87k20t+Fg4ZuYBXwwhvozByFOOkG5JDQ6yFkeuJJBWExfNtR6U/EokB6oO6wVWiqi6YpqF1aI9QojYVN5k5NL1niDRhH2N3M5YhFrCv4JasBIrQ8Z3UD8ou4cauOt7FylA5WCyS2bBM4tSfBOYR5Vsen4rKMqJZDTqIMZpQS3oh74lT/N5u3ClFNw5DBwAgixzfL4um8eE38SxsffDCqZqgbu/9L+2+oHF9C/4Gc5oawnJopxFVUq9ZhgONmjIJPUK7PJHyF1es+AZTjIvEJMDmuFesw+gWz7tEKpsHug/syJZOYZlQtsu3ZyLYiDub8/ug1tBhUpsjJsWtOxRLj2uqDqCoKYC3XccwGkjc0GdIjuTFSnhekZHmkXFd+zpCjJuYIAsx6cym2ig0Hwl+X0h4MtM4DEDKKJ4BbJeb1IlPGmRYlz+t5QIe5sG87DHrTftFjBxb5A/EknhAoAWDuzUbsSHTVAgNs3OPJf21RGPTD2R0MMOiD6/hd7QKJsNNsxwAaoqPs1D9Mdn9oRxyTPdCJdORwJ9lhf+YXbwBZLSSpMcH631JQrszgAZj7uoNODLSAWHBTlp0QUArh1ELP1bMZ1Z2ifMAsT7Bo4h1CTbCtVVt24+8=
  - secure: TMduu41/AuBmvT9c1zQT9cOIsFP4CnLOG6iC/kseXZxDUuSHNk+0kwgwGpRGg4fKTWOUPS83fC5wyl16CiqHlhViRbSkyV5ujTlmM2g5IIDbWX7Z7+vJRULXre8Ow7vsa12e4T4FOY1WsriFq26Xh0jqVGl1bsUu+lkFccxAjJSNisifanyDEjsNo/A4ci2PA/BuzO+KsoUof6XwozF8Xg84LCWHOFIP8aEmGNJe5KSshkQPK5xA3T0uszdt3O5eq2anjhSpTUHopeRjFu7uAy69ll7E9HjxmECfCJZT5iHs75icWrVZrat9upww+3ciEjBGyiz+47fXN2gdq7JLgLxTsgeDMQ44KW4TjTmqIarqMIM9qnU5UeVrmvmF/dFOFWSWX9oT2nRntfsawIp/E8dgdsPNXSP3l6DoMGK6gZyT6nTCLs69kmPV9vU5ojY4DBYI4VjbW8X5TqfkJTUxFGj/LUgaLGAAzlJNeji7aUQ43+zG4bYOHn8e6s2mBZCYq5RPpfiOHOV92rHNxP5aFhZXUmJEoaS2T80TUhocvWE1mH6ctCera6E3miSVGdeK9xJgA8caXsaLfrKWyVd19JppsnM+B0ZwQU6WTj/KcaaOYYG6uOgdyGm3Sjg+ugjufdcyLwz6A4g3ltLLyifAA7PwUaNU3sAxHuwfv85ULJo=
  - secure: K9IZGT2hrKb/6Ygt1oRbiLKCTWD2Hdp7VHAB5RjaoC9xxWG4kRsnCE5OqKGFUWIEAXozYzZUnaDyTHuupVjZjHlMxA71VXuwl1B1/0MD9F+8fJ6h4D9GuXr+7MBI8o2OTdpSjl1fPHSFTJ1il2dpwIq1GNBwFIKFd7djpi3BWCaFQUaCfIP5P0OFIkAv+9MY98iT92URNvI29dIPH3LIGlA2RCsQuCGMW7qJmOPQ2JNZuWMqZ+B2tphXBmBdtRaEJAZgMFc0vkP/rB3e17DfastFfJVfCO/DK3Z5+q9ltkFSpa5gRutOVOHsyJJLWKVdz1CukT85RwBvB4X89+Tvl0cmOCLHto3VpvCdAaal7B8tYAhMdvLH03Y1MTwCBqB1gim45N0iEYnbYJsor3x0MzdUaKL7AlzYLgG+rJ8Ly62FY6W1ypVwRh+zxMlpnCiarSeFboh25BJGBKneMPG1NeT96GKV+JDHEiLnfzbjIi6FWpV6w9Vg/iN62Za+l0fWDeYJtaSr89JEnOFVvjKL9FTQ3jKkUUOqqFm0+OVAgkYnmPYzZSRUWiLIkw3wfW6C4o5NJvM/lWvywoBOmZb9IMJ09H3uXsL2KyZzEP9uN/46O4abUQJHNJgu6F/uPI7elK9gU+ILPUPn8ppqL2mzpwR9ZaEv27hwNEFb6EmVbHk=
  - secure: ZqN6z4SvOnz+e6s/UX9FhNcSCqKVi2c07k1tLVfkwOmKDNjqXzFPLHZWc+lc5fygY8dkSeJzTkBfh2K0ELUD3jS4tWltoTpZUaoifQdYLPhhIJ6auE82YcOhIPlWo2bAb1tjR6hotrtyIJ9qLgaJFdpLlusHX726q+qqqvbEs3R8W9D4hgwX16fhsb12Xr+5trXeTfJjz7bLzjxt4plcBmJsjOK430GSa5qTcVqJeMbXfYx8EgcP1dmwdHNFYpoRJZxC2IVzOYpA+eh4hzOfBLzQkKaARg9IwBCTLkMlshANLEE5CdeH37/zeTzfjaqtsY6fesdFwWXfjZE8F9dqKvHftBgCJi5g4PMROScRZDO05erzMUPjdq3a2rUyyMSA9oFcG0IGRQ3BlcZBXocjuR5YUpAENRqSUZiYJxuanoFAAFgNGOBbJWCGj4cOF6lpON0Cjjg+lcUhvPtUuJJ+FYAO8qdBG10+1FZrEksMPFpKSj6JkYRHeDL30V8PuKVzI7wO2MHQukUxCnr3BAfuPYeRsmFn1LWbP9sMwTJrK02K/LT13Qco5RpAI2tdtIREYiTBz2H4sCsOnEJgmm9MHg0INmekQwEVMwebpubQwOAmbkr0MdVLL51DBQpK9oejmSmz156LievuFJkq/mbN0NUbNg6Ycu6X1SU2YIHTYC4=
  - secure: mQ+ulAbvjFWiPvpDNw2l5fhAcMxZ/Ggd8dWDiAhvCuLKcHJGDUgBQSwJbqdyjW5SP2eNCJo6mRpzEYtKdHr2PDr6UUM0x9YOVZkFAjHDrXE14Y+5BLiNKD0pF0rGtEoOsl8sCapwjWm9IaCf69xtHO2u5sAjlgqqFin9VLlLuoenLCETatJBTpIwnN76sD4MqQK6lfaEv/PI3TrP2YX6kQihIeLe6IwbCKaYw6InMI0rs4VP9Lx5rPlEWgyzTQiCz6CpM+no7HVpeHfTRAyzpq1zxzRcyO7E12mF18xYYQXMVWiqOwcCJZeR6YS8MnJ+Fcpt2RFRJuD10Ehnvz2N/dieynhFutevIEl7hm3VZvwfs6eI+XplnXT15aDmmqGNsreV7omx4ISbdoGed/gfoaxdEKMtDr/XbxgKcQ2LI4dCVFmRWh0riX1gbjyJJ0TVPLGo6zOOQMEZ9R4L4GNE6Rt3oXcYK/GJOk0cVcYix8lt9VGcP5PrkNM8VoZKlZGfYZVEGHg/s5HzuER3wXr0rtDlnxcHKtTkG9jhNeUQhSy/xxfEDFwEBtiF8B6Ujt+sDTHNfrCbWwrDqRlv0CGty7sfjdHz4+bq0imUq+lKusorVvvtXarwtziPYTEcIs6tefrcEStsBIgrXEepWo2YMtbq5lyiwobkNF8beUODrfs=
  - secure: BYvdKNWJ9sUvu+5XdcvFajJPGajK6xaL4qIhk4cWQhrVLzozT08iQRdL71aofHDF3Fd7Y9p576ynD4+3BJ6ptSCVrOWT5uEAf6pYS5eyUd+wD1mfY5GkVWxUVYmEABoD2LqW7etws5+ZrG/bQWDh0wPu8y2rCD9F+ELhdhu1F3WFA9+4015yX5rW7FXn3bRI9wwh0/zvU/xenmGgus+3USNdhajLop+H008tbPxhb4eKuKyGlQgbRI6rPcBOvxvrEWO+H+72DWDojepN+qZjNsUCM3qtrjTTAa3j77QMqQjJkmMlNBAs3kY4YfPNPU3DRXD6UPygRuLinq1h0QOatvOHLx/OgyKz/9W+EpkHt5jOnyF6cjdTxCx62wvX8LMWv/BEiWViGTNRgTumXJU5jKsMKw6Wzb/p4Aee/VCbI055eV40qaWwbWOMfzpcESLg5+UIcROilTL3qvPSYYm0o9rvqxE710AggVHnZG5a3Bs+xg7OkzLUXbTV11FcSy54B95ult7b+u4wzfiOdcUr0gp7cWZNSTvk3Bkbf0nSxBVKKeVTBzkQsJQx6RyuahACrM+vs3/DfOdSgs1NjjShQ2lkIxJfsuXG0EAHLpo08TagLB/UZARerz75ehG0pVX7lXgMSos6Z+aKRKkSF/LIRFA0rooGDcXaCGsgUaj36tY=
  - secure: UMQXI0vu2bkX9c0cmC9hzaphF0IiaOekUhpX2Rfjhpa/HjaA45ZsSvfzZZKbGRGGLPfISD7pBFAY5SVjl3lVNgYCsDHYxzOfQRuQ/EBAy3sf2UrkqRIzz/vzNOc233D/uhe3r6cn/GujbEBeGWYjGFq+tjZXHyi3J+hl2OjW6kSvRFOr+8z92rbWPY7Nsoh9B5EB4dbawIruUZHviLtbHZs0FO0zh/ZDJF37oGwHyJ+50+tXb8hRgzQM9ZsHLFwZuU6+dEtt8ql+QbYtIhTzKXJ9zKNj8MnMvQmne4jEGfbvhqVKZV/7eO3u44klzjiusarflRiXxnZoDsH4r1LVDSjU5rF9JNlZVUzUywuEwXoffIQ54OTxCeoI5RMklMdWMQgVDbnfZ+pMuYjKNFJVtm0ny4/0s+BswTv7PcMyhJuDot2oGtGabyYzk302d+Z4xPiJuyBiDqBpit+pzTR58rZ6mlkjBOEAdOjvTVYzufbYVmOIK53viONoXA8AiXAFk5n5tzJ4Fu7nmncrfL7L9Oox5FkombBmxETsgY+1Gl8akKRm2Ey+bQrfyjEFGfrZUojvQrG/8jVv/EuLkQ34z6EOrN1SIm8cgLfkfH5wGl8FOfWOcjJigQxeE7Rb3r4dA7rD5pFUPt5qpQ0Ei6O7DpxyeTg/Xsq6XZhDctGqQa8=
before_install:
  # decrypt all deploy key files
  - bash ci-scripts/decrypt-deploy-keys.sh
before_script:
  # spin up the dev docker containers
  - docker-compose up --build -d
script:
  # run the tests
  - "./test.sh"
after_script:
  # spin down the dev docker containers
  - docker-compose down
before_deploy:
  # build the application for prod
  - bash ci-scripts/build.sh
deploy:
  # deploy to prod
  provider: script
  script: bash ci-scripts/deploy.sh
  skip_cleanup: true  # do not clean working dir so we can push build code
  on:
    branch: master
